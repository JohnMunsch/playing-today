let games = [
  {
    id: 'bf2eac92-d567-4c8f-9292-bc381c81b7ff',
    name: 'Carcassonne',
    notes: 'Plays with six if you add the Inns & Cathedrals.',
    players: [
      { best: 56.4, not: 6.1, num: 2, recommended: 37.6 },
      { best: 47.3, not: 2.3, num: 3, recommended: 50.3 },
      { best: 31.7, not: 8.6, num: 4, recommended: 59.7 },
      { best: 12, not: 35.4, num: 5, recommended: 52.7 }
    ]
  },
  {
    id: '8b7225b3-49e8-4faa-a688-6903daabd831',
    name: 'Jamaica',
    players: [
      { best: 3.9, not: 58.3, num: 2, recommended: 37.9 },
      { best: 8.2, not: 25.8, num: 3, recommended: 66 },
      { best: 33.6, not: 0.9, num: 4, recommended: 65.5 },
      { best: 45, not: 0, num: 5, recommended: 55 },
      { best: 70.9, not: 4.5, num: 6, recommended: 24.5 }
    ]
  },
  {
    id: 'c9aedb08-4750-4e30-b151-5d0af893db31',
    name: 'Augustus',
    players: [
      { best: 6.7, not: 20, num: 2, recommended: 73.3 },
      { best: 50.9, not: 0, num: 3, recommended: 49.1 },
      { best: 67.9, not: 0, num: 4, recommended: 32.1 },
      { best: 35.4, not: 4.2, num: 5, recommended: 60.4 },
      { best: 23.9, not: 15.2, num: 6, recommended: 60.9 }
    ]
  },
  {
    id: '56add321-2739-477e-904c-a98efdfcd781',
    name: 'No Thanks!',
    players: [
      { best: 1, not: 92.2, num: 2, recommended: 6.8 },
      { best: 17.5, not: 18.9, num: 3, recommended: 63.6 },
      { best: 57.7, not: 0, num: 4, recommended: 42.3 },
      { best: 73, not: 0.7, num: 5, recommended: 26.4 }
    ]
  },
  {
    id: '2b749a03-2064-4bd1-91d7-7e031bc7c925',
    name: 'Rattus',
    players: [
      { best: 6.8, not: 45.9, num: 2, recommended: 47.3 },
      { best: 28.6, not: 3.9, num: 3, recommended: 67.5 },
      { best: 87.8, not: 2.4, num: 4, recommended: 9.8 }
    ]
  },
  {
    id: 'f04b9d3c-f881-49bb-8550-607c536192d0',
    name: 'Agricola: All Creatures Big and Small',
    players: [{ best: 94, not: 1.2, num: 2, recommended: 4.8 }]
  },
  {
    id: '663e1f22-f49c-454e-810f-a9d1a2b2b9e6',
    name: 'Dice Town',
    players: [
      { best: 4.7, not: 53.5, num: 2, recommended: 41.9 },
      { best: 20.9, not: 16.3, num: 3, recommended: 62.8 },
      { best: 67.4, not: 2.2, num: 4, recommended: 30.4 },
      { best: 48.9, not: 6.4, num: 5, recommended: 44.7 }
    ]
  },
  {
    id: '51924643-f638-46c2-9a3c-c57388efc5b0',
    name: 'Saboteur',
    players: [
      { best: 1.4, not: 83.7, num: 3, recommended: 15 },
      { best: 4.3, not: 58.4, num: 4, recommended: 37.3 },
      { best: 21.5, not: 8.6, num: 5, recommended: 69.9 },
      { best: 37.3, not: 6.5, num: 6, recommended: 56.2 },
      { best: 64.7, not: 1.2, num: 7, recommended: 34.1 },
      { best: 58.8, not: 4.1, num: 8, recommended: 37.2 },
      { best: 31.6, not: 9.6, num: 9, recommended: 58.8 },
      { best: 24.8, not: 14.3, num: 10, recommended: 60.9 }
    ]
  },
  {
    id: '24e07277-07b1-4f2f-8211-a5b0edb64c18',
    name: 'Bang! The Dice Game',
    players: [
      { best: 0, not: 87.1, num: 3, recommended: 12.9 },
      { best: 3.5, not: 55.8, num: 4, recommended: 40.7 },
      { best: 32.6, not: 1.1, num: 5, recommended: 66.3 },
      { best: 68.8, not: 0, num: 6, recommended: 31.3 },
      { best: 64.8, not: 1.1, num: 7, recommended: 34.1 },
      { best: 39.5, not: 5.8, num: 8, recommended: 54.7 }
    ]
  },
  {
    id: '1f93c211-2a6e-45c4-9a7e-a1eee54cd673',
    name: 'Cacao',
    players: [
      { best: 19.4, not: 6.5, num: 2, recommended: 74.2 },
      { best: 69.7, not: 3, num: 3, recommended: 27.3 },
      { best: 34.3, not: 5.7, num: 4, recommended: 60 }
    ]
  },
  {
    id: '5994017b-c74f-4be6-a98b-f9aeb4e8e502',
    name: 'Dominion',
    players: [
      { best: 38.4, not: 6, num: 2, recommended: 55.6 },
      { best: 56.7, not: 1, num: 3, recommended: 42.3 },
      { best: 39.6, not: 6.9, num: 4, recommended: 53.5 }
    ]
  },
  {
    id: '330b1f99-a58f-4a54-b8ef-77fc5de49f32',
    name: 'For Sale',
    players: [
      { best: 7.7, not: 19.6, num: 3, recommended: 72.6 },
      { best: 41.2, not: 0, num: 4, recommended: 58.8 },
      { best: 69.4, not: 1.2, num: 5, recommended: 29.5 },
      { best: 32.5, not: 8.8, num: 6, recommended: 58.8 }
    ]
  },
  {
    id: '66536087-e2b1-4577-8cfd-32d21645cd70',
    name: 'High Society',
    players: [
      { best: 20, not: 21.5, num: 3, recommended: 58.5 },
      { best: 63.6, not: 0, num: 4, recommended: 36.4 },
      { best: 56.3, not: 3.1, num: 5, recommended: 40.6 }
    ]
  },
  {
    id: '290d4c7b-0283-4f7c-af7c-1c482adc3604',
    name: 'Sushi Go',
    players: [
      { best: 5.7, not: 39.8, num: 2, recommended: 54.5 },
      { best: 44.9, not: 2.2, num: 3, recommended: 52.8 },
      { best: 71.1, not: 1, num: 4, recommended: 27.8 },
      { best: 33.3, not: 7.7, num: 5, recommended: 59 }
    ]
  },
  {
    id: '72224ded-ba1c-46b1-be50-ba37b0d757e2',
    name: 'Coup Rebellion G54',
    players: [
      { best: 7.1, not: 28.6, num: 3, recommended: 64.3 },
      { best: 35.7, not: 0, num: 4, recommended: 64.3 },
      { best: 85.7, not: 0, num: 5, recommended: 14.3 },
      { best: 64.3, not: 7.1, num: 6, recommended: 28.6 }
    ]
  },
  {
    id: '52301397-b561-4a09-95ae-2afcb2f129eb',
    name: 'Splendor',
    players: [
      { best: 34.5, not: 7.8, num: 2, recommended: 57.8 },
      { best: 53.2, not: 2, num: 3, recommended: 44.8 },
      { best: 37.5, not: 8.2, num: 4, recommended: 54.3 }
    ]
  },
  {
    id: 'ff726975-ebab-40ba-bc38-e547d5f8d5f5',
    name: 'Settlers of Catan, The',
    players: [
      { best: 35, not: 7.1, num: 3, recommended: 57.9 },
      { best: 75.9, not: 2, num: 4, recommended: 22.1 }
    ]
  },
  {
    id: '97a63307-16c5-42c5-a156-dbb3dde3c58b',
    name: 'Carcassonne: The Castle',
    players: [{ best: 96.5, not: 0, num: 2, recommended: 3.5 }]
  }
];
let players = [
  {
    id: 'fd89b8ae-c5d9-4420-a54e-730d21661698',
    email: 'mike.wartberg@aptitude.com',
    playingToday: false
  },
  {
    id: 'ffcada8b-7637-4847-b040-055090496ed7',
    email: 'john.munsch@aptitude.com',
    playingToday: true
  },
  {
    id: '632d994f-9a3c-4c22-bc10-7460b1e1ac0c',
    email: 'trang.ngo@aptitude.com',
    playingToday: false
  },
  {
    id: '9a030301-c50e-4d5f-bb8a-c5b5bf94d365',
    email: 'sfisherm@vha.com',
    playingToday: true
  },
  {
    id: '2ce12aba-9a04-4c7a-99ac-2c5e748221ef',
    email: 'luis.gomez@aptitude.com',
    playingToday: false
  },
  {
    id: '14e853b3-3f9d-4706-ac02-ac697cd2a27e',
    email: 'david.daniels@aptitude.com',
    playingToday: false
  },
  {
    id: 'f87b8aaa-1d51-4e06-abd0-2c0f9a8dac62',
    email: 'mike.nguchie@aptitude.com',
    playingToday: false
  },
  {
    id: '01d431fc-d729-4a32-b16c-f57cd284a69f',
    email: 'barry.forrest@vizientinc.com',
    playingToday: false
  },
  {
    id: '04ff1fc9-14ee-4851-bc7f-7c0d690d2d86',
    email: 'richard.morgan@aptitude.com',
    playingToday: false
  },
  {
    id: 'e164bb94-1e4e-4b34-b421-006e2666a3e5',
    email: 'kavya.katam@aptitude.com',
    playingToday: false
  }
];

function uuidv4() {
  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
    var r = (Math.random() * 16) | 0,
      v = c == 'x' ? r : (r & 0x3) | 0x8;
    return v.toString(16);
  });
}

const STATUS_CHANGED_TOPIC = 'Status Changed';

module.exports = {
  Query: {
    info: () =>
      `This is the API of a In/Out board for player check in for getting together to play games.`,
    me: () => {
      return players.find(
        player => player.email === 'john.munsch@aptitude.com'
      );
    },
    games: () => games,
    players: () => players
  },
  Mutation: {
    // (id: String!, playingToday: Boolean!): Player!
    playing: (context, args, { pubsub }) => {
      // Find the player in question and set his/her status for gaming today.
      let player = players.find(player => player.id === args.id);

      player.playingToday = args.playingToday;

      pubsub.publish(STATUS_CHANGED_TOPIC, { statusChange: players });

      return player;
    },

    reset: (parent, args, { pubsub }) => {
      players = players.map(player => {
        player.playingToday = false;

        return player;
      });

      pubsub.publish(STATUS_CHANGED_TOPIC, { statusChange: players });

      return false;
    },

    // (name: String!, notes: String, players: RecommendationInput): Game!
    createGame: (context, args) => {
      let newGame = {
        id: uuidv4(),
        name: args.name,
        notes: args.notes,
        players: args.players
      };

      games.push(newGame);

      return newGame;
    },
    // (id: String!): Game
    deleteGame: (context, args) => {
      let match = null;

      games = games.filter(game => {
        if (game.id === args.id) {
          match = game;
          return false;
        } else {
          return true;
        }
      });

      return match;
    },

    // (email: String!): Player!
    createPlayer: (context, args, { pubsub }) => {
      let newPlayer = {
        id: uuidv4(),
        email: args.email,
        playingToday: false
      };

      players.push(newPlayer);

      pubsub.publish(STATUS_CHANGED_TOPIC, { statusChange: players });

      return newPlayer;
    },
    // (id: String!): Player!
    deletePlayer: (context, args, { pubsub }) => {
      let match = null;

      players = players.filter(player => {
        if (player.id === args.id) {
          match = player;
          return false;
        } else {
          return true;
        }
      });

      pubsub.publish(STATUS_CHANGED_TOPIC, { statusChange: players });

      return match;
    }
  },
  Subscription: {
    statusChange: {
      subscribe: (parent, args, { pubsub }) => {
        return pubsub.asyncIterator(STATUS_CHANGED_TOPIC);
      }
    }
  }
};
